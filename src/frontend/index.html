<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Sistema de Emergências - Escola</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>

    <style>
        body {
            background: #f3f3f3;
        }
        .container {
            margin-top: 30px;
        }
        .card {
            margin-bottom: 20px;
        }
        pre {
            background: #222;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
        }
    </style>
</head>
<body>

<div class="container">

    <h1 class="text-center mb-4">Sistema de Emergências</h1>

    <ul class="nav nav-tabs" id="myTab" role="tablist">

        <li class="nav-item">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#nova">
                Abrir Emergência
            </button>
        </li>

        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#listar-emergencias">
                Listar Emergências
            </button>
        </li>

        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#registrar">
                Registrar Atendimento
            </button>
        </li>

        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#listar-atendimentos">
                Listar Atendimentos
            </button>
        </li>

        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#notificacoes">
                Notificações
            </button>
        </li>

        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#logs">
                Logs de Ação
            </button>
        </li>

    </ul>

    <div class="tab-content">

        <div class="tab-pane fade show active" id="nova">

            <div class="card">
                <div class="card-header">Abrir Nova Emergência</div>
                <div class="card-body">

                    <label>Aluno ID:</label>
                    <input id="abrirAlunoId" type="number" class="form-control mb-2"/>

                    <label>Descrição:</label>
                    <input id="abrirDescricao" class="form-control mb-3"/>

                    <button class="btn btn-primary" onclick="abrirEmergencia()">Abrir Emergência</button>

                    <h5 class="mt-3">Resposta:</h5>
                    <pre id="respAbrir"></pre>
                </div>
            </div>

        </div>

        <div class="tab-pane fade" id="listar-emergencias">

            <div class="card">
                <div class="card-header">
                    Emergências Registradas
                    <button class="btn btn-sm btn-secondary float-end" onclick="listarEmergencias()">Atualizar</button>
                </div>
                <div class="card-body">
                    <pre id="respListarEmergencias"></pre>
                </div>
            </div>

        </div>

        <div class="tab-pane fade" id="registrar">

            <div class="card">
                <div class="card-header">Registrar Atendimento</div>
                <div class="card-body">

                    <label>ID da Emergência:</label>
                    <input id="atEmergenciaId" type="number" class="form-control mb-2"/>

                    <label>Decisão:</label>
                    <input id="atDecisao" class="form-control mb-2"/>

                    <label>Observações:</label>
                    <input id="atObs" class="form-control mb-3"/>

                    <button class="btn btn-success" onclick="registrarAtendimento()">Registrar</button>

                    <h5 class="mt-3">Resposta:</h5>
                    <pre id="respRegistrar"></pre>
                </div>
            </div>

        </div>

        <div class="tab-pane fade" id="listar-atendimentos">

            <div class="card">
                <div class="card-header">
                    Atendimentos Registrados
                    <button class="btn btn-sm btn-secondary float-end" onclick="listarAtendimentos()">Atualizar</button>
                </div>
                <div class="card-body">
                    <pre id="respListarAtendimentos"></pre>
                </div>
            </div>

        </div>

        <div class="tab-pane fade" id="notificacoes">

            <div class="card">
                <div class="card-header">
                    Notificações
                    <button class="btn btn-sm btn-secondary float-end" onclick="listarNotificacoes()">Atualizar</button>
                </div>

                <div class="card-body">
                    <div id="listaNotificacoes"></div>
                </div>
            </div>

        </div>

        <div class="tab-pane fade" id="logs">

            <div class="card">
                <div class="card-header">
                    Logs de Ação
                    <button class="btn btn-sm btn-secondary float-end" onclick="listarLogs()">Atualizar</button>
                </div>
                <div class="card-body">
                    <pre id="respLogs"></pre>
                </div>
            </div>

        </div>

    </div>

</div>

<script>
    const API = "http://localhost:8080";

    function abrirEmergencia() {
        const alunoId = document.getElementById("abrirAlunoId").value;
        const descricao = document.getElementById("abrirDescricao").value;

        fetch(API + "/emergencias", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ alunoId, descricao })
        })
            .then(r => r.json())
            .then(data => document.getElementById("respAbrir").textContent = JSON.stringify(data, null, 2));
    }

    function listarEmergencias() {
        fetch(API + "/emergencias")
            .then(r => r.json())
            .then(data => document.getElementById("respListarEmergencias").textContent = JSON.stringify(data, null, 2));
    }

    function registrarAtendimento() {
        const emergenciaId = document.getElementById("atEmergenciaId").value;
        const decisao = document.getElementById("atDecisao").value;
        const observacoes = document.getElementById("atObs").value;

        fetch(`${API}/atendimentos/${emergenciaId}`, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ decisao, observacoes })
        })
            .then(r => r.json())
            .then(data => document.getElementById("respRegistrar").textContent = JSON.stringify(data, null, 2));
    }

    function listarAtendimentos() {
        fetch(API + "/atendimentos")
            .then(r => r.json())
            .then(data => document.getElementById("respListarAtendimentos").textContent = JSON.stringify(data, null, 2));
    }

    function listarNotificacoes() {
        fetch(API + "/notificacoes")
            .then(r => r.json())
            .then(lista => {
                const box = document.getElementById("listaNotificacoes");
                box.innerHTML = "";

                lista.forEach(n => {
                    const card = document.createElement("div");
                    card.classList.add("card");
                    card.innerHTML = `
                        <div class="card-body">
                            <b>Destino:</b> ${n.tipo}<br>
                            <b>Mensagem:</b> ${n.mensagem}<br>
                            <b>Data:</b> ${n.dataHora}<br>
                            <b>Emergência:</b> ${n.emergenciaId}
                        </div>
                    `;
                    box.appendChild(card);
                });
            });
    }

    function listarLogs() {
        fetch(API + "/logs")
            .then(r => r.json())
            .then(data => {
                document.getElementById("respLogs").textContent =
                    JSON.stringify(data, null, 2);
            });
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
